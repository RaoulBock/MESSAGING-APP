<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>MESSAGING APP</title>
    <script src="/socket.io/socket.io.js"></script>

    <script>
      const socket = io();

      let phoneNumber;
      let username;

      function login() {
        phoneNumber = document.getElementById("phoneNumber").value;

        if (!phoneNumber || isNaN(phoneNumber) || phoneNumber.length !== 10) {
          alert("Please enter a valid 10-digit phone number.");
          return;
        }

        const usernameInput = document.getElementById("usernameInput");
        usernameInput.style.display = "block";
        document.getElementById("phoneNumberInput").style.display = "none";
      }

      function setUsername() {
        username = document.getElementById("username").value;

        if (!username || username.trim() === "") {
          alert("Please enter a username.");
          return;
        }

        socket.emit("login", { phoneNumber, username });

        document.getElementById("loginSection").style.display = "none";
        document.getElementById("chatSection").style.display = "block";
      }

      function sendMessage() {
        const message = document.getElementById("message").value;
        socket.emit("chat message", { phoneNumber, message });
        document.getElementById("message").value = "";
      }

      function sendImage(event) {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = (e) => {
          socket.emit("chat message", { type: "image", data: e.target.result }); // Send image data
        };

        if (file) {
          reader.readAsDataURL(file);
        }
      }

      function displayMessage(msg) {
        const messages = document.getElementById("messages");
        const li = document.createElement("li");
        li.innerHTML = `<strong>${username}:</strong> ${msg.message}`;
        messages.appendChild(li);
      }

      socket.on("chat message", displayMessage);

      // socket.on("chat message", (msg) => {
      //   const messages = document.getElementById("messages");
      //   if (msg.type === "text") {
      //     const li = document.createElement("li");
      //     li.appendChild(document.createTextNode(msg.data));
      //     messages.appendChild(li);
      //   } else if (msg.type === "image") {
      //     const img = document.createElement("img");
      //     img.src = msg.data;
      //     img.style.maxWidth = "200px"; // Set a maximum width for displayed images
      //     const li = document.createElement("li");
      //     li.appendChild(img);
      //     messages.appendChild(li);
      //   }
      // });
    </script>
  </head>
  <body>
    <div id="loginSection">
      <div id="phoneNumberInput">
        <h3>Login with Phone Number</h3>
        <input
          id="phoneNumber"
          type="text"
          placeholder="Enter your phone number"
        />
        <button onclick="login()">Login</button>
      </div>

      <div id="usernameInput" style="display: none">
        <h3>Enter Username</h3>
        <input id="username" type="text" placeholder="Enter your username" />
        <button onclick="setUsername()">Set Username</button>
      </div>
    </div>

    <div id="chatSection" style="display: none">
      <h3>Chat Interface</h3>
      <ul id="messages"></ul>
      <input id="message" autocomplete="off" />
      <button onclick="sendMessage()">Send</button>
      <input type="file" accept="image/*" onchange="sendImage(event)" />
    </div>
  </body>
</html>
